<!DOCTYPE html>
<html>
<head>
    <title>Debug Test - Marathon Registration</title>
    <style>
        body { font-family: Arial, sans-serif; padding: 20px; }
        .result { margin: 20px 0; padding: 10px; border: 1px solid #ccc; }
        .success { background: #d4edda; border-color: #c3e6cb; }
        .error { background: #f8d7da; border-color: #f5c6cb; }
        button { padding: 10px 20px; margin: 5px; }
        input { padding: 8px; margin: 5px; width: 200px; }
    </style>
</head>
<body>
    <h1>Marathon Registration Debug Test</h1>
    
    <div>
        <h3>Quick Tests with Real Data:</h3>
        <button onclick="testMobile()">Test Mobile: 01611741684</button>
        <button onclick="testTransaction()">Test Transaction: CGB2KOYULI</button>
        <button onclick="testAPI()">Test API Connection</button>
    </div>
    
    <div>
        <h3>Manual Test:</h3>
        <select id="type">
            <option value="mobile">Mobile</option>
            <option value="transaction">Transaction</option>
        </select>
        <input type="text" id="value" placeholder="Enter value">
        <button onclick="manualTest()">Search</button>
    </div>
    
    <div id="result" class="result" style="display:none;"></div>

    <script>
        const API_URL = 'https://script.google.com/macros/s/AKfycbxa6-hycDC9W4Ze6aH-Ja3Wo1amI_nIeqiXhfawWgrBH7Sf25gZ15ses-wtFBYfc1vD/exec';
        
        function showResult(message, isSuccess = false) {
            const resultDiv = document.getElementById('result');
            resultDiv.innerHTML = message;
            resultDiv.className = 'result ' + (isSuccess ? 'success' : 'error');
            resultDiv.style.display = 'block';
        }
        
        async function testAPI() {
            try {
                showResult('Testing API connection...');
                const response = await fetch(API_URL);
                const data = await response.json();
                showResult(`API Response: ${JSON.stringify(data)}`, true);
            } catch (error) {
                showResult(`API Error: ${error.message}`);
            }
        }
        
        async function testMobile() {
            await searchTest('mobile', '01611741684');
        }
        
        async function testTransaction() {
            await searchTest('transaction', 'CGB2KOYULI');
        }
        
        async function manualTest() {
            const type = document.getElementById('type').value;
            const value = document.getElementById('value').value;
            if (!value) {
                alert('Enter a value!');
                return;
            }
            await searchTest(type, value);
        }
        
        async function searchTest(searchType, searchValue) {
            try {
                showResult(`Searching for ${searchType}: ${searchValue}...`);
                
                const response = await fetch(API_URL, {
                    method: 'POST',
                    headers: {
                        'Content-Type': 'application/json',
                    },
                    body: JSON.stringify({
                        action: 'searchRegistration',
                        searchType: searchType,
                        searchValue: searchValue
                    })
                });
                
                console.log('Response status:', response.status);
                console.log('Response headers:', response.headers);
                
                if (!response.ok) {
                    throw new Error(`HTTP ${response.status}: ${response.statusText}`);
                }
                
                const result = await response.json();
                console.log('Full result:', result);
                
                if (result.success && result.data) {
                    showResult(`
                        <h3>‚úÖ FOUND!</h3>
                        <p><strong>Name:</strong> ${result.data.name}</p>
                        <p><strong>Mobile:</strong> ${result.data.mobile}</p>
                        <p><strong>Email:</strong> ${result.data.email}</p>
                        <p><strong>T-shirt:</strong> ${result.data.tshirtSize}</p>
                        <p><strong>Serial:</strong> ${result.data.serialNumber}</p>
                        <p><strong>Payment:</strong> ${result.data.paymentStatus}</p>
                        <p><strong>Found in Row:</strong> ${result.data.foundInRow}</p>
                        <p><strong>Found in Column:</strong> ${result.data.foundInColumn}</p>
                        <p><strong>Full Response:</strong> <pre>${JSON.stringify(result, null, 2)}</pre></p>
                    `, true);
                } else {
                    showResult(`
                        <h3>‚ùå NOT FOUND</h3>
                        <p><strong>Message:</strong> ${result.message}</p>
                        <p><strong>Full Response:</strong> <pre>${JSON.stringify(result, null, 2)}</pre></p>
                    `);
                }
                
            } catch (error) {
                console.error('Error details:', error);
                showResult(`
                    <h3>üö® ERROR</h3>
                    <p><strong>Error:</strong> ${error.message}</p>
                    <p><strong>Type:</strong> ${error.name}</p>
                    <p><strong>Stack:</strong> <pre>${error.stack}</pre></p>
                `);
            }
        }
    </script>
</body>
</html>
